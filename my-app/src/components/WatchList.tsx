import React, { useEffect } from 'react'
import CustomTable from './CustomTable'
import { useContext } from 'react'
import { CoinContext } from '@/context/coinContext'
import { useState } from 'react'
import { usePathname } from 'next/navigation'

const WatchList = () => {
    const pathname=usePathname();
     //@ts-ignore
    const { watchList, RecentlyViewed,setWatchList ,Coin}=useContext(CoinContext);
    const [path, setpath] = useState('')
    
     // TODO remove 
    const [displayCoin, setDisplayCoin]=useState<any[]>([
        {
          "id": "bitcoin",
          "symbol": "btc",
          "name": "Bitcoin",
          "image": "https://coin-images.coingecko.com/coins/images/1/large/bitcoin.png?1696501400",
          "current_price": 65534,
          "market_cap": 1292830286087,
          "market_cap_rank": 1,
          "fully_diluted_valuation": 1376273415590,
          "total_volume": 38624662277,
          "high_24h": 66059,
          "low_24h": 62602,
          "price_change_24h": 2259.67,
          "price_change_percentage_24h": 3.57122,
          "market_cap_change_24h": 54460462285,
          "market_cap_change_percentage_24h": 4.39775,
          "circulating_supply": 19726775,
          "total_supply": 21000000,
          "max_supply": 21000000,
          "ath": 73738,
          "ath_change_percentage": -11.02201,
          "ath_date": "2024-03-14T07:10:36.635Z",
          "atl": 67.81,
          "atl_change_percentage": 96657.84996,
          "atl_date": "2013-07-06T00:00:00.000Z",
          "roi": null,
          "last_updated": "2024-07-17T07:08:00.806Z"
        },
        {
          "id": "ethereum",
          "symbol": "eth",
          "name": "Ethereum",
          "image": "https://coin-images.coingecko.com/coins/images/279/large/ethereum.png?1696501628",
          "current_price": 3488.74,
          "market_cap": 419563506454,
          "market_cap_rank": 2,
          "fully_diluted_valuation": 419563506454,
          "total_volume": 20029721713,
          "high_24h": 3516.21,
          "low_24h": 3356.94,
          "price_change_24h": 78.87,
          "price_change_percentage_24h": 2.31291,
          "market_cap_change_24h": 12470494357,
          "market_cap_change_percentage_24h": 3.0633,
          "circulating_supply": 120221218.029974,
          "total_supply": 120221218.029974,
          "max_supply": null,
          "ath": 4878.26,
          "ath_change_percentage": -28.39644,
          "ath_date": "2021-11-10T14:24:19.604Z",
          "atl": 0.432979,
          "atl_change_percentage": 806638.75249,
          "atl_date": "2015-10-20T00:00:00.000Z",
          "roi": {
            "times": 70.17212660772108,
            "currency": "btc",
            "percentage": 7017.212660772108
          },
          "last_updated": "2024-07-17T07:07:55.410Z"
        },
        {
          "id": "tether",
          "symbol": "usdt",
          "name": "Tether",
          "image": "https://coin-images.coingecko.com/coins/images/325/large/Tether.png?1696501661",
          "current_price": 1,
          "market_cap": 113227600545,
          "market_cap_rank": 3,
          "fully_diluted_valuation": 113227600545,
          "total_volume": 58585024479,
          "high_24h": 1.003,
          "low_24h": 0.996601,
          "price_change_24h": -0.000928732975302049,
          "price_change_percentage_24h": -0.09278,
          "market_cap_change_24h": 498258663,
          "market_cap_change_percentage_24h": 0.442,
          "circulating_supply": 113224555138.644,
          "total_supply": 113224555138.644,
          "max_supply": null,
          "ath": 1.32,
          "ath_change_percentage": -24.37453,
          "ath_date": "2018-07-24T00:00:00.000Z",
          "atl": 0.572521,
          "atl_change_percentage": 74.77037,
          "atl_date": "2015-03-02T00:00:00.000Z",
          "roi": null,
          "last_updated": "2024-07-17T07:05:45.943Z"
        },
        {
          "id": "binancecoin",
          "symbol": "bnb",
          "name": "BNB",
          "image": "https://coin-images.coingecko.com/coins/images/825/large/bnb-icon2_2x.png?1696501970",
          "current_price": 582.15,
          "market_cap": 89651642954,
          "market_cap_rank": 4,
          "fully_diluted_valuation": 89651642954,
          "total_volume": 1059831417,
          "high_24h": 584.53,
          "low_24h": 556.68,
          "price_change_24h": 14.25,
          "price_change_percentage_24h": 2.50872,
          "market_cap_change_24h": 3048389517,
          "market_cap_change_percentage_24h": 3.51995,
          "circulating_supply": 153856150,
          "total_supply": 153856150,
          "max_supply": 200000000,
          "ath": 717.48,
          "ath_change_percentage": -18.69848,
          "ath_date": "2024-06-06T14:10:59.816Z",
          "atl": 0.0398177,
          "atl_change_percentage": 1464872.53432,
          "atl_date": "2017-10-19T00:00:00.000Z",
          "roi": null,
          "last_updated": "2024-07-17T07:08:07.251Z"
        },
        {
          "id": "solana",
          "symbol": "sol",
          "name": "Solana",
          "image": "https://coin-images.coingecko.com/coins/images/4128/large/solana.png?1718769756",
          "current_price": 160.95,
          "market_cap": 74787181752,
          "market_cap_rank": 5,
          "fully_diluted_valuation": 93494913743,
          "total_volume": 3327954899,
          "high_24h": 163.79,
          "low_24h": 153.01,
          "price_change_24h": 5.94,
          "price_change_percentage_24h": 3.83181,
          "market_cap_change_24h": 3201176443,
          "market_cap_change_percentage_24h": 4.47179,
          "circulating_supply": 464176132.48874,
          "total_supply": 580288044.713239,
          "max_supply": null,
          "ath": 259.96,
          "ath_change_percentage": -37.96407,
          "ath_date": "2021-11-06T21:54:35.825Z",
          "atl": 0.500801,
          "atl_change_percentage": 32102.02701,
          "atl_date": "2020-05-11T19:35:23.449Z",
          "roi": null,
          "last_updated": "2024-07-17T07:08:03.804Z"
        },
        {
          "id": "ripple",
          "symbol": "xrp",
          "name": "XRP",
          "image": "https://coin-images.coingecko.com/coins/images/44/large/xrp-symbol-white-128.png?1696501442",
          "current_price": 0.612337,
          "market_cap": 34053495528,
          "market_cap_rank": 8,
          "fully_diluted_valuation": 61014273864,
          "total_volume": 3731084920,
          "high_24h": 0.61002,
          "low_24h": 0.534794,
          "price_change_24h": 0.071308,
          "price_change_percentage_24h": 13.18007,
          "market_cap_change_24h": 4013094952,
          "market_cap_change_percentage_24h": 13.35899,
          "circulating_supply": 55805339473,
          "total_supply": 99987452475,
          "max_supply": 100000000000,
          "ath": 3.4,
          "ath_change_percentage": -82.07501,
          "ath_date": "2018-01-07T00:00:00.000Z",
          "atl": 0.00268621,
          "atl_change_percentage": 22577.76738,
          "atl_date": "2014-05-22T00:00:00.000Z",
          "roi": null,
          "last_updated": "2024-07-17T07:07:53.821Z"
        },
        {
          "id": "staked-ether",
          "symbol": "steth",
          "name": "Lido Staked Ether",
          "image": "https://coin-images.coingecko.com/coins/images/13442/large/steth_logo.png?1696513206",
          "current_price": 3490.92,
          "market_cap": 33999858417,
          "market_cap_rank": 6,
          "fully_diluted_valuation": 33999858417,
          "total_volume": 85557565,
          "high_24h": 3514.6,
          "low_24h": 3355.38,
          "price_change_24h": 77.22,
          "price_change_percentage_24h": 2.26198,
          "market_cap_change_24h": 897073910,
          "market_cap_change_percentage_24h": 2.70997,
          "circulating_supply": 9739933.35374592,
          "total_supply": 9739933.35374592,
          "max_supply": null,
          "ath": 4829.57,
          "ath_change_percentage": -27.68299,
          "ath_date": "2021-11-10T14:40:47.256Z",
          "atl": 482.9,
          "atl_change_percentage": 623.26122,
          "atl_date": "2020-12-22T04:08:21.854Z",
          "roi": null,
          "last_updated": "2024-07-17T07:07:58.480Z"
        },
        {
          "id": "usd-coin",
          "symbol": "usdc",
          "name": "USDC",
          "image": "https://coin-images.coingecko.com/coins/images/6319/large/usdc.png?1696506694",
          "current_price": 0.999556,
          "market_cap": 33939396802,
          "market_cap_rank": 7,
          "fully_diluted_valuation": 33983577912,
          "total_volume": 8475975185,
          "high_24h": 1.003,
          "low_24h": 0.99645,
          "price_change_24h": -0.001398409359721464,
          "price_change_percentage_24h": -0.13971,
          "market_cap_change_24h": 63781740,
          "market_cap_change_percentage_24h": 0.18828,
          "circulating_supply": 33962610376.3024,
          "total_supply": 34006821705.2194,
          "max_supply": null,
          "ath": 1.17,
          "ath_change_percentage": -14.76128,
          "ath_date": "2019-05-08T00:40:28.300Z",
          "atl": 0.877647,
          "atl_change_percentage": 13.89546,
          "atl_date": "2023-03-11T08:02:13.981Z",
          "roi": null,
          "last_updated": "2024-07-17T07:07:57.807Z"
        },
        {
          "id": "the-open-network",
          "symbol": "ton",
          "name": "Toncoin",
          "image": "https://coin-images.coingecko.com/coins/images/17980/large/ton_symbol.png?1696517498",
          "current_price": 7.31,
          "market_cap": 18372039804,
          "market_cap_rank": 9,
          "fully_diluted_valuation": 37366059448,
          "total_volume": 326201008,
          "high_24h": 7.42,
          "low_24h": 7.28,
          "price_change_24h": -0.08911463245525741,
          "price_change_percentage_24h": -1.20384,
          "market_cap_change_24h": -155799502.5197296,
          "market_cap_change_percentage_24h": -0.84089,
          "circulating_supply": 2512021150.92705,
          "total_supply": 5109086016.6142,
          "max_supply": null,
          "ath": 8.25,
          "ath_change_percentage": -11.32797,
          "ath_date": "2024-06-15T00:36:51.509Z",
          "atl": 0.519364,
          "atl_change_percentage": 1309.15499,
          "atl_date": "2021-09-21T00:33:11.092Z",
          "roi": null,
          "last_updated": "2024-07-17T07:08:00.179Z"
        },
        {
          "id": "dogecoin",
          "symbol": "doge",
          "name": "Dogecoin",
          "image": "https://coin-images.coingecko.com/coins/images/5/large/dogecoin.png?1696501409",
          "current_price": 0.125973,
          "market_cap": 18293810367,
          "market_cap_rank": 10,
          "fully_diluted_valuation": 18293810367,
          "total_volume": 908499031,
          "high_24h": 0.127744,
          "low_24h": 0.119423,
          "price_change_24h": 0.00364006,
          "price_change_percentage_24h": 2.97554,
          "market_cap_change_24h": 740612534,
          "market_cap_change_percentage_24h": 4.21925,
          "circulating_supply": 145147656383.705,
          "total_supply": 145147656383.705,
          "max_supply": null,
          "ath": 0.731578,
          "ath_change_percentage": -82.74836,
          "ath_date": "2021-05-08T05:08:23.458Z",
          "atl": 0.0000869,
          "atl_change_percentage": 145128.70343,
          "atl_date": "2015-05-06T00:00:00.000Z",
          "roi": null,
          "last_updated": "2024-07-17T07:08:02.771Z"
        },
        {
          "id": "cardano",
          "symbol": "ada",
          "name": "Cardano",
          "image": "https://coin-images.coingecko.com/coins/images/975/large/cardano.png?1696502090",
          "current_price": 0.447709,
          "market_cap": 15911524120,
          "market_cap_rank": 11,
          "fully_diluted_valuation": 20136425414,
          "total_volume": 432661017,
          "high_24h": 0.449199,
          "low_24h": 0.42718,
          "price_change_24h": 0.01337598,
          "price_change_percentage_24h": 3.07966,
          "market_cap_change_24h": 624317567,
          "market_cap_change_percentage_24h": 4.08392,
          "circulating_supply": 35558375961.7143,
          "total_supply": 45000000000,
          "max_supply": 45000000000,
          "ath": 3.09,
          "ath_change_percentage": -85.48906,
          "ath_date": "2021-09-02T06:00:10.474Z",
          "atl": 0.01925275,
          "atl_change_percentage": 2226.62799,
          "atl_date": "2020-03-13T02:22:55.044Z",
          "roi": null,
          "last_updated": "2024-07-17T07:08:10.692Z"
        },
        {
          "id": "tron",
          "symbol": "trx",
          "name": "TRON",
          "image": "https://coin-images.coingecko.com/coins/images/1094/large/tron-logo.png?1696502193",
          "current_price": 0.134696,
          "market_cap": 11733470396,
          "market_cap_rank": 12,
          "fully_diluted_valuation": 11733548914,
          "total_volume": 412624176,
          "high_24h": 0.134699,
          "low_24h": 0.132799,
          "price_change_24h": 0.00099905,
          "price_change_percentage_24h": 0.74725,
          "market_cap_change_24h": 85000416,
          "market_cap_change_percentage_24h": 0.72971,
          "circulating_supply": 87109495761.8811,
          "total_supply": 87110078677.3905,
          "max_supply": null,
          "ath": 0.231673,
          "ath_change_percentage": -41.86938,
          "ath_date": "2018-01-05T00:00:00.000Z",
          "atl": 0.00180434,
          "atl_change_percentage": 7363.81994,
          "atl_date": "2017-11-12T00:00:00.000Z",
          "roi": {
            "times": 69.89276475320926,
            "currency": "usd",
            "percentage": 6989.276475320927
          },
          "last_updated": "2024-07-17T07:07:58.169Z"
        },
        {
          "id": "shiba-inu",
          "symbol": "shib",
          "name": "Shiba Inu",
          "image": "https://coin-images.coingecko.com/coins/images/11939/large/shiba.png?1696511800",
          "current_price": 0.00001953,
          "market_cap": 11513608629,
          "market_cap_rank": 13,
          "fully_diluted_valuation": 19538691297,
          "total_volume": 610448970,
          "high_24h": 0.00001986,
          "low_24h": 0.00001855,
          "price_change_24h": 5.88445e-7,
          "price_change_percentage_24h": 3.1066,
          "market_cap_change_24h": 443668082,
          "market_cap_change_percentage_24h": 4.00786,
          "circulating_supply": 589261850628817,
          "total_supply": 999982348148859,
          "max_supply": null,
          "ath": 0.00008616,
          "ath_change_percentage": -77.30444,
          "ath_date": "2021-10-28T03:54:55.568Z",
          "atl": 5.6366e-11,
          "atl_change_percentage": 34691177.13518,
          "atl_date": "2020-11-28T11:26:25.838Z",
          "roi": null,
          "last_updated": "2024-07-17T07:08:15.197Z"
        },
        {
          "id": "avalanche-2",
          "symbol": "avax",
          "name": "Avalanche",
          "image": "https://coin-images.coingecko.com/coins/images/12559/large/Avalanche_Circle_RedWhite_Trans.png?1696512369",
          "current_price": 28.66,
          "market_cap": 11336257035,
          "market_cap_rank": 14,
          "fully_diluted_valuation": 12753584923,
          "total_volume": 584637447,
          "high_24h": 29.18,
          "low_24h": 26.55,
          "price_change_24h": 1.68,
          "price_change_percentage_24h": 6.21185,
          "market_cap_change_24h": 807029766,
          "market_cap_change_percentage_24h": 7.66466,
          "circulating_supply": 394687705.734412,
          "total_supply": 444033966.206074,
          "max_supply": 720000000,
          "ath": 144.96,
          "ath_change_percentage": -80.19275,
          "ath_date": "2021-11-21T14:18:56.538Z",
          "atl": 2.8,
          "atl_change_percentage": 925.06858,
          "atl_date": "2020-12-31T13:15:21.540Z",
          "roi": null,
          "last_updated": "2024-07-17T07:08:08.236Z"
        },
        {
          "id": "wrapped-bitcoin",
          "symbol": "wbtc",
          "name": "Wrapped Bitcoin",
          "image": "https://coin-images.coingecko.com/coins/images/7598/large/wrapped_bitcoin_wbtc.png?1696507857",
          "current_price": 65534,
          "market_cap": 10129377335,
          "market_cap_rank": 15,
          "fully_diluted_valuation": 10129377335,
          "total_volume": 409865023,
          "high_24h": 66029,
          "low_24h": 62603,
          "price_change_24h": 2020.21,
          "price_change_percentage_24h": 3.18074,
          "market_cap_change_24h": 376292289,
          "market_cap_change_percentage_24h": 3.85819,
          "circulating_supply": 154534.93092871,
          "total_supply": 154534.93092871,
          "max_supply": 154534.93092871,
          "ath": 73505,
          "ath_change_percentage": -10.75598,
          "ath_date": "2024-03-14T07:10:23.403Z",
          "atl": 3139.17,
          "atl_change_percentage": 1989.69847,
          "atl_date": "2019-04-02T00:00:00.000Z",
          "roi": null,
          "last_updated": "2024-07-17T07:08:12.025Z"
        },
        {
          "id": "polkadot",
          "symbol": "dot",
          "name": "Polkadot",
          "image": "https://coin-images.coingecko.com/coins/images/12171/large/polkadot.png?1696512008",
          "current_price": 6.47,
          "market_cap": 8981069986,
          "market_cap_rank": 16,
          "fully_diluted_valuation": 9504515658,
          "total_volume": 242816907,
          "high_24h": 6.5,
          "low_24h": 6.15,
          "price_change_24h": 0.210336,
          "price_change_percentage_24h": 3.35998,
          "market_cap_change_24h": 359732102,
          "market_cap_change_percentage_24h": 4.17258,
          "circulating_supply": 1388892653.48802,
          "total_supply": 1469841788.67426,
          "max_supply": null,
          "ath": 54.98,
          "ath_change_percentage": -88.23045,
          "ath_date": "2021-11-04T14:10:09.301Z",
          "atl": 2.7,
          "atl_change_percentage": 139.89297,
          "atl_date": "2020-08-20T05:48:11.359Z",
          "roi": null,
          "last_updated": "2024-07-17T07:07:57.072Z"
        },
        {
          "id": "chainlink",
          "symbol": "link",
          "name": "Chainlink",
          "image": "https://coin-images.coingecko.com/coins/images/877/large/chainlink-new-logo.png?1696502009",
          "current_price": 14.34,
          "market_cap": 8715219466,
          "market_cap_rank": 17,
          "fully_diluted_valuation": 14331886001,
          "total_volume": 442772021,
          "high_24h": 14.61,
          "low_24h": 13.84,
          "price_change_24h": 0.251728,
          "price_change_percentage_24h": 1.78688,
          "market_cap_change_24h": 230673588,
          "market_cap_change_percentage_24h": 2.71875,
          "circulating_supply": 608099971.3083414,
          "total_supply": 1000000000,
          "max_supply": 1000000000,
          "ath": 52.7,
          "ath_change_percentage": -72.79256,
          "ath_date": "2021-05-10T00:13:57.214Z",
          "atl": 0.148183,
          "atl_change_percentage": 9575.45149,
          "atl_date": "2017-11-29T00:00:00.000Z",
          "roi": null,
          "last_updated": "2024-07-17T07:08:09.094Z"
        },])

    function handleOnDrop(e:React.DragEvent){
        const recent= e.dataTransfer.getData("watchList") as string;
        console.log("recent", recent)
        if(!watchList.find((item:any)=>item.id==recent)){
          const newWatch= displayCoin.find((Coin:any)=>Coin.id==recent);
          setWatchList([newWatch,...watchList])
        }
       
      }

      useEffect(()=>{

        if(pathname){
            setpath(pathname)
            console.log("searchItemsearchItem", pathname)
        }

      },[pathname])

   

  function handleDragOver(e:React.DragEvent){
    e.preventDefault();
  }

  return (
    <div className={`sidebar z-[10] flex flex-col  left-0 gap-10 ${path.includes('/coin' )? 'mt-[0px]'  : 'mt-[-280px]'}`}>
         
    <div className='watchList p-4 overflow-scroll   border-s-orange-100 border-solid border-2 rounded-lg  h-[300px] w-[400px] ' onDrop={handleOnDrop} onDragOver={handleDragOver}>
      <div className='w-full flex justify-between'>
          <h1 className=''>Watch List</h1>

          <p className='text-sm text-slate-400'>(Drag from the list)</p>

      </div>
      
      <CustomTable 
       Items={watchList}
      
     /> 
    </div>

    <div className='RecentlyViewed p-4  border-s-orange-100 rounded-lg overflow-scroll   border-2  h-[300px] w-[400px] '>
        <h1 className=''>Recently Viewed</h1>
        <CustomTable 
          Items={RecentlyViewed}
        /> 
    </div>

  </div>
  )
}

export default WatchList
